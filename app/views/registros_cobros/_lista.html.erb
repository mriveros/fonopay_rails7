<% if @citas.present? %>

  <% @citas.each do |ps| %>

    <tr>

      <td><%= ps.cita_id %></td>
      <td><%= ps.fecha_cita.strftime('%d/%m/%Y')%></td>
      <td><%= ps.paciente_documento %></td>
      <td><%= ps.paciente_nombre %> <%= ps.paciente_apellido %></td>
      <td><%= ps.mes_letra %></td>
      <td><%= ps.anho.to_i %></td>
      <td><%= ps.profesional_nombre %> <%= ps.profesional_apellido %></td>
      <td><%= ps.precio.to_s.reverse.gsub(/...(?=.)/,'\&.').reverse %></td>
      <td><%= ps.estado_cobro %></td>
      
      <td>

      <%#= link_to_cuota_detalle(ps.cuota_id) %>

      <%if ps.estado_cobro_id == PARAMETRO[:estado_cobro_pendiente] || ps.estado_cobro_id == PARAMETRO[:estado_cobro_no_cobrado]%>
        
        <%= link_to_notificar_pago_pendiente(ps.cita_id) %>    
        <%= link_to icon_confirmar_cobro,"#", onclick: "cambiar_estado_cobro_a_cobrado(#{ps.cita_id});return false;", class: "btn btn-success btn-xs", id: "btn-cambiar-estado-cobro-cobrado", title: 'Haga click aquí para marcar esta cita como Cobrado.' if acceso_permitido("registros_cobros.cambiar_estado_cobro_a_cobrado")%>
          
      <%end%>

      <%if ps.estado_cobro_id == PARAMETRO[:estado_cobro_cobrado] %>
            
            <%= link_to icon_desconfirmar_cobro,"#", onclick: "cambiar_estado_cobro_a_no_cobrado(#{ps.cita_id});return false;", class: "btn btn-warning btn-xs", id: "btn-cambiar-estado-cobro-no-cobrado", title: 'Haga click aquí para marcar esta cita como No Cobrado.' if acceso_permitido("registros_cobros.cambiar_estado_cobro_a_no_cobrado")%>
          
        <%end%>

      <%#= link_to icon_eliminar,"#", onclick: "eliminar_registro(#{ps.cuota_id});return false;", class: "btn btn-danger btn-xs", id: "btn-eliminar-pago-salario", title: 'Haga click para eliminar la cuota Generada'  %>

       </td>

      </td>

    </tr>

  <% end %>

<tr id="tab-paginacion">

    <td colspan="12" style="text-align:center;"><div class="flickr_pagination"><%= ajax_will_paginate citas, :params => params %></div></td>

</tr>

<tr>
    <td colspan="12">

      Cantidad de registros encontrados: <%= @total_encontrados %>

    </td>
</tr>

 

<% else %>

  <tr>

    <td colspan="12"><p class='none-result'>No se han encontrado resultados.</p></td>

  </tr>


<% end %>


<script type="text/javascript">

  function eliminar_registro(cuota_id) {

    swal({
      title: "Confirmar",
      text: "Al confirmar se eliminará permanentemente de la lista de Cuotas Generadas.",
      type: "warning",
      showCancelButton: true,
      confirmButtonClass: "btn-confirm",
      confirmButtonText: "Confirmar",
      cancelButtonText: "Cancelar",
      closeOnConfirm: true,
      closeOnCancel: true
    },
    function(isConfirm) {
      if (isConfirm) {

        $.ajax({
          url: "<%#= url_for(cuotas_eliminar_path) %>",
          data: {id: cuota_id},
          dataType: 'script'
        });

      } else{

        return false;

      }

    });

  }

  function cambiar_estado_cobro_a_cobrado(cita_id) {

        swal({
          title: "Confirmar",
          text: "Al confirmar el estado de cobro de la Cita pasará a ser Cobrado",
          type: "warning",
          showCancelButton: true,
          confirmButtonClass: "btn-confirm",
          confirmButtonText: "Confirmar",
          cancelButtonText: "Cancelar",
          closeOnConfirm: true,
          closeOnCancel: true
        },
        function(isConfirm) {
          if (isConfirm) {

              $.ajax({
                url: "<%= url_for(registros_cobros_cambiar_estado_cobro_a_cobrado_path) %>", 
                data: {id: cita_id},
                dataType: 'script'
              });
            
          } else{

            return false;

          }

        });
  }

  function cambiar_estado_cobro_a_no_cobrado(cita_id) {

        swal({
          title: "Confirmar",
          text: "Al confirmar el estado de cobro de la Cita ésta pasará a estar marcado como No Cobrado",
          type: "warning",
          showCancelButton: true,
          confirmButtonClass: "btn-confirm",
          confirmButtonText: "Confirmar",
          cancelButtonText: "Cancelar",
          closeOnConfirm: true,
          closeOnCancel: true
        },
        function(isConfirm) {
          if (isConfirm) {

              $.ajax({
                url: "<%= url_for(registros_cobros_cambiar_estado_cobro_a_no_cobrado_path) %>", 
                data: {id: cita_id},
                dataType: 'script'
              });
            
          } else{

            return false;

          }

        });
  }

</script>